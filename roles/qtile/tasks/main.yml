---
- name: Install qtile
  yaourt:
    name: qtile-python3-git

- name: Install optional dependencies
  pacman:
    name: '{{ item }}'
  become_user: root
  loop:
    - alsa-utils
    - python-iwlib
    - python-setproctitle

- name: Install config dependencies
  pacman:
    name: python-dbus, python-parse, feh
  become_user: root

- name: Install the pynput librairy
  pip:
    name: pynput
  become_user: root

- name: Create qtile config directory
  file:
    path: '{{ config_home }}/qtile'
    state: directory

- name: Configure qtile
  template:
    src: '{{ item }}.py.j2'
    dest: '{{ config_home }}/qtile/{{ item }}.py'
  loop:
    - bars
    - config
    - keys
    - util
    - colors
    - widgets

- name: Make wallpaper is present in '{{ pictures_dir }}'
  command: rclone copy ncloud:Pictures/{{ wallpaper_name }} {{ pictures_dir }}
  args:
    creates: '{{ pictures_dir }}/{{ wallpaper_name }}'

- name: Symlink the wallpaper
  file:
    src: '{{ pictures_dir }}/{{ wallpaper_name }}'
    path: '{{ user_dir }}/.wallpaper'
    state: link

- import_tasks: png-icons.yml
